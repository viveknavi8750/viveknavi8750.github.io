<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PG Tenant Manager</title>
<style>
body{
  margin:0;
  font-family:Arial;
  background:#f4f6f8;
}
.container{
  display:flex;
  height:100vh;
}
.sidebar{
  width:220px;
  background:#111827;
  color:white;
  padding:20px 10px;
  display:flex;
  flex-direction:column;
}
.sidebar button{
  background:none;
  border:none;
  color:white;
  padding:12px;
  text-align:left;
  font-size:15px;
  margin:4px 0;
  cursor:pointer;
  border-radius:6px;
}
.sidebar button.active,
.sidebar button:hover{
  background:#1f2937;
}
.main{
  flex:1;
  padding:20px;
  overflow:auto;
}

/* Card */
.card{
  background:white;
  padding:20px;
  border-radius:10px;
  box-shadow:0 3px 8px rgba(0,0,0,0.1);
  margin-bottom:20px;
}

/* Input */
input, select{
  width:100%;
  padding:10px;
  margin-bottom:10px;
  border:1px solid #d1d5db;
  border-radius:6px;
  font-size:15px;
}
label{
  font-size:14px;
  font-weight:bold;
}

/* Button */
.btn{
  background:#2563eb;
  border:none;
  color:white;
  padding:10px 20px;
  font-size:15px;
  border-radius:6px;
  cursor:pointer;
}
.btn:hover{
  background:#1d4ed8;
}

/* List */
.item{
  background:#f9fafb;
  padding:14px;
  border-radius:8px;
  border:1px solid #e5e7eb;
  margin-bottom:12px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.small-btn{
  padding:6px 10px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  font-size:13px;
  margin-left:6px;
}
.edit{ background:#10b981; color:white; }
.remove{ background:#ef4444; color:white; }

/* Pagination */
.pagination button{
  padding:6px 10px;
  margin:2px;
  border:1px solid #d1d5db;
  border-radius:6px;
  background:white;
}
.pagination button.active{
  background:#2563eb !important;
  color:white !important;
}

/* Dashboard blocks */
.stat-box{
  background:white;
  padding:20px;
  border-radius:10px;
  text-align:center;
  box-shadow:0 3px 8px rgba(0,0,0,0.1);
  margin-bottom:20px;
}
.stat-number{
  font-size:30px;
  font-weight:bold;
}
</style>
</head>

<body>
<div class="container">

  <!-- Sidebar -->
  <div class="sidebar">
    <button onclick="showSection('dashboard')" id="btn-dashboard" class="active">ðŸ“Š Dashboard</button>
    <button onclick="showSection('add')" id="btn-add">âž• Add Tenant</button>
    <button onclick="showSection('list')" id="btn-list">ðŸ‘¥ Show Tenants</button>
  </div>

  <!-- Main Content -->
  <div class="main">

    <!-- Dashboard -->
    <div id="section-dashboard" class="card">
      <h2>ðŸ“Š PG Dashboard</h2>
      <div id="dashboard-content">Loading...</div>
    </div>

    <!-- Add Tenant -->
    <div id="section-add" class="card" style="display:none;">
      <h2>âž• Add Tenant</h2>

      <form id="tenantForm">
        <label>Name</label>
        <input type="text" id="name" required>

        <label>Phone</label>
        <input type="text" id="phone" required>

        <label>Room</label>
        <select id="room" required></select>

        <label>Bed (1â€“4)</label>
        <select id="bed" required>
          <option value="">Select Bed</option>
          <option>1</option>
          <option>2</option>
          <option>3</option>
          <option>4</option>
        </select>

        <label>Move In</label>
        <input type="date" id="moveIn">

        <label>Move Out</label>
        <input type="date" id="moveOut">

        <label>Rent</label>
        <input type="number" id="rent">

        <label>Rent Status</label>
        <select id="rentStatus">
          <option>Paid</option>
          <option>Pending</option>
        </select>

        <button class="btn" type="submit">Save Tenant</button>
      </form>
    </div>

    <!-- Tenant List -->
    <div id="section-list" class="card" style="display:none;">
      <h2>ðŸ‘¥ Tenants</h2>

      <input type="text" id="search" placeholder="Search name / phone / room">
      <select id="filter-room"></select>

      <div id="tenant-list"></div>

      <div class="pagination" id="pagination"></div>
    </div>

  </div>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyeYacsS876b0w1-pytYjPgo7XUAfsnLpkFoFgmPiOQDX0KunscC0ts5O57cUIDQ3zStA/exec";   // <<< CHANGE THIS LINE ONLY
const rooms = ["101","102","103","104","105","106","201","202","203","204","205","206",
"301","302","303","304","305","306","401","402","403","404","405","406",
"501","502","503","504","505","506","601","602","603"];

const tenants=[];
let currentPage=1;
const perPage=8;

/* ---------------- Nav ---------------- */
function showSection(sec){
  document.querySelectorAll('.sidebar button').forEach(b=>b.classList.remove('active'));
  document.querySelector('#btn-'+sec).classList.add('active');

  document.querySelectorAll('.card').forEach(c=>c.style.display='none');
  document.querySelector('#section-'+sec).style.display='block';

  if(sec==='list') loadTenants();
  if(sec==='dashboard') loadDashboard();
}

/* -------------- Populate rooms -------------- */
function initRooms(){
  let roomSelect=document.getElementById("room");
  let filter=document.getElementById("filter-room");
  rooms.forEach(r=>{
    roomSelect.innerHTML+=`<option>${r}</option>`;
    filter.innerHTML+=`<option value="${r}">${r}</option>`;
  });
  filter.innerHTML=`<option value="">All Rooms</option>`+filter.innerHTML;
}
initRooms();

/* ---------------- API wrapper ---------------- */
async function api(action, method="GET", body=null){
  let opts={ method };
  if(body){
    opts.headers={"Content-Type":"application/json"};
    opts.body=JSON.stringify(body);
  }
  let res = await fetch(`${SCRIPT_URL}?action=${action}`, opts);
  return res.json();
}

/* ---------------- Load Dashboard ---------------- */
async function loadDashboard(){
  let d = await api("dashboard");
  let h = `
    <div class='stat-box'>
      <div class='stat-number'>${Object.values(d.floors).reduce((a,b)=>a+b,0)}</div>
      Total Tenants
    </div>
  `;
  document.getElementById("dashboard-content").innerHTML=h;
}

/* ---------------- Add Tenant ---------------- */
document.getElementById("tenantForm").addEventListener("submit", async (e)=>{
  e.preventDefault();

  let payload={
    name: name.value,
    phone: phone.value,
    room: room.value,
    bed: bed.value,
    moveIn: moveIn.value,
    moveOut: moveOut.value,
    rent: rent.value,
    rentStatus: rentStatus.value
  };

  // check bed count
  let count = tenants.filter(t=>t.room===payload.room).length;
  if(count>=4){
    alert("This room already has 4 tenants!");
    return;
  }

  await api("add","POST",payload);

  e.target.reset();
  alert("Tenant added!");

  loadTenants();
});

/* ---------------- Load Tenants ---------------- */
async function loadTenants(){
  let data = await api("list");
  tenants.length=0;
  data.forEach(t=>tenants.push(t));

  renderList();
}

/* ---------------- Render Tenant List ---------------- */
function renderList(){
  let q = search.value.toLowerCase();
  let fr = document.getElementById("filter-room").value;

  let filtered = tenants.filter(t=>
    (t.name.toLowerCase().includes(q) ||
     t.phone.includes(q) ||
     t.room.includes(q)) &&
    (fr==="" || t.room===fr)
  );

  let total=filtered.length;
  let pages=Math.ceil(total/perPage);
  if(currentPage>pages) currentPage=1;

  let start=(currentPage-1)*perPage;
  let pageData=filtered.slice(start,start+perPage);

  let list=document.getElementById("tenant-list");
  list.innerHTML="";

  pageData.forEach(t=>{
    list.innerHTML+=`
      <div class="item">
        <div>
          <strong>${t.name}</strong><br>
          ${t.phone} | Room ${t.room} | Bed ${t.bed}
        </div>
        <div>
          <button class="small-btn edit" onclick="editTenant(${t.row})">Edit</button>
          <button class="small-btn remove" onclick="deleteTenant(${t.row})">Delete</button>
        </div>
      </div>
    `;
  });

  // Pagination
  let pag=document.getElementById("pagination");
  pag.innerHTML="";
  for(let i=1;i<=pages;i++){
    pag.innerHTML+=`<button class="${i==currentPage?'active':''}" onclick="gotoPage(${i})">${i}</button>`;
  }
}

function gotoPage(p){
  currentPage=p;
  renderList();
}

search.oninput = renderList;
filter-room?.onchange = renderList;

/* ---------------- Delete Tenant ---------------- */
async function deleteTenant(row){
  if(!confirm("Delete this tenant?")) return;
  await api("delete","GET",{id:row});
  loadTenants();
}

/* ---------------- Edit Tenant (future expansion) ---------------- */
function editTenant(row){
  alert("Edit UI coming next â€” backend is ready.");
}

loadDashboard();
</script>
</body>
</html>
